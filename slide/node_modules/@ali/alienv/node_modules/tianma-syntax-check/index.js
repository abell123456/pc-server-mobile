'use strict';

var vm = require('vm');

module.exports = function (config) {
	config = config || {};

	return function *(next) {
		var req = this.request;
		var res = this.response;

		yield next;

		if (res.is('js')) {
			new vm.Script(
				res.data().toString(),
				{
					filename: req.pathname
				}
			);
		}
	};
};