'use strict';

module.exports = function (config) {
    // Load dependencies.
    var http = require('http');
    var https = require('@ali/easy-https');
    var tianma = require('tianma');

    // Initiate config.
    var port = config.port;
    var portssl = config.portssl;
    var root = config.root || './';

    // Config the pipeline.
    var app = tianma();

    app
        .form()
        .dynamic()
        .static(root);

    // Create server.
    if (port) {
        http.createServer(app.run).listen(port);
        console.log('[i] Listen to http://127.0.0.1:%s ..', port);
    }

    if (portssl) {
        https.createServer(app.run).listen(portssl);
        console.log('[i] Listen to https://127.0.0.1:%s ..', portssl);
    }

    console.log('[i] To stop service, press [Ctrl + C] ..');
};
